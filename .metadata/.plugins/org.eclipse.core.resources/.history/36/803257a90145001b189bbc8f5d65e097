<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<script src="http://code.jquery.com/jquery-3.1.1.min.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Insert title here</title>
<style>
#oriTbl, #tbl{padding:10px 10px 5px 10px;}
td {
   padding: 5px 5px 5px 5px;
   font-size:17px;
}
</style>
</head>
<body>

<table id="oriTbl">
<tr style="margin-right:10px;">
      <td><input type="password" style="border:none; width:200px; height:30px; border-bottom:1px solid gray;" placeholder="현재 비밀번호 확인" id="oriPwChk"></td>
   </tr>
   <tr style="margin-right:10px;"><td><input type="button" value="확인" id="chk" style="margin-top:10px;"></td></tr>
</table>

<form name="frm" action="pwUpdate" method="post">

<table id="tbl">
   <tr class="register" style="margin-right:10px;">
      <td><input type="password" name="oriPw" style="border:none; width:200px; height:30px; border-bottom:1px solid gray;" placeholder="현재 비밀번호" id="oriPw"></td>
   </tr>
   <tr class="register" style="margin-right:10px;">
      <td class="pw"><input type="password" name="newPw" style="border:none; width:200px; height:30px; border-bottom:1px solid gray;" placeholder="새 비밀번호" id="pw"></td>
   </tr>
   <tr class="register" style="margin-right:10px;">
      <td class="pwChk"><input type="password" name="adminPassword" style="border:none; width:200px; height:30px; border-bottom:1px solid gray;" placeholder="비밀번호 확인" id="pwChk"></td>
   </tr>
   
   <tr>
   <td><input type="submit" name="btnSave" value="저장" style="margin-top:10px;"> </td>
   </tr>
</table>
</form>
</body>
<script>
$("#tbl").hide();

$("#chk").on("click", function() {
	var pwp = $(this).parent().parent().parent().find("#oriPwChk");
	var pw = $(this).parent().parent().parent().find("#oriPwChk").val();
	$.ajax({
		type:"get",
		url:"pwChk.json",
		data:{"password":pw},
		success:function(data) {
			if(data == 0) {
				$("#oriTbl").hide();
				$("#tbl").show();
			}
			if(data == 1) {
				pwp.css("background", "red");
				pwp.focus();
				setTimeout(pwp.css("background", "white"), 10000);
			}
		}
	});
});

$("#pw").keyup(function() {
	var pwcp = $(this).parent().parent().parent().find(".pwChk").find("#pwChk");
	var pw = $(this).val();
	var pwChk = pwcp.val();
	if(pw != pwChk) {
		pwcp.css("background", "#FF7E7E");
		$("#pw").css("background", "#FF7E7E");
	}
	if(pw == pwChk) {
		pwcp.css("background", "#9BFF94");
		$("#pw").css("background", "#9BFF94");
	}
});

$("#pwChk").keyup(function() {
	var pwp = $(this).parent().parent().parent().find(".pw").find("#pw");
	var pw = pwp.val();
	var pwChk = $(this).val();
	if(pw != pwChk) {
		pwp.css("background", "#FF7E7E");
		$(this).css("background", "#FF7E7E");
	}
	if(pw == pwChk) {
		pwp.css("background", "#9BFF94");
		$(this).css("background", "#9BFF94");
	}
});

$("#pwChk").focusout(function() {
	var pwChk = $(this).val();
	var pw = $(this).parent().parent().parent().find(".pw").find("#pw").val();
	if(pwChk != pw) {
		alert("비밀번호가 일치하지 않습니다.");
		$("#pw").focus();
	}
});



//저장 눌렀을때

$(frm.btnSave).click(function(e){
   e.preventDefault();
var oriPw=$(frm.oriPw).val();
var newPw=$(frm.newPw).val();
var adminPassword=$(frm.adminPassword).val();
   if(oriPw.trim()==""){
      alert("기존의 비밀번호를 입력하시오.");
      frm.oriPw.focus();
   }else if(newPw.trim()==""){
      alert("새 비밀번호를 입력하시오");
      frm.newPw.focus();
   }else if(adminPassword.trim()==""){
      alert("확인하실 비밀번호를 입력하시오.");
      frm.adminPassword.focus();
   }   else if(newPw.trim()!=adminPassword.trim()){
      alert("비밀번호가 일치하지 않습니다.");
   }else{
      $.ajax({
         type:"post",
         url:"pwUpdate",
         data:{"adminPassword":adminPassword},
         success:function(){
            if(!confirm("등록하시겠습니까?"))return;
            frm.submit();
            alert("변경완료");
            window.close();
         }
//    window.close();
//     location.href="main";
    
      });
   }
});

      

// $("#btnSave").on("click",function(){
//    if(!confirm("저장 하시겠습니까?"))return;
//    frm.submit();
//    location.href="main";
// });
//새로운 비번

         </script>
</html>